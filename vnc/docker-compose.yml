services:
  vnc:
    image: browser-use-vnc:latest
    build: .
    environment:
      - DISPLAY=:99
      - SESSION_ID=${SESSION_ID}
      - NOVNC_PORT=${NOVNC_PORT}
    ports:
      - "${NOVNC_PORT}:6080"   # 예: 6081, 6082, ...
    labels:
      - "bu.session=${SESSION_ID}"
      - "bu.role=vnc"
    volumes:
      - x11sock:/tmp/.X11-unix

  agent:
    image: browser-use-agent:latest
    build:
      context: ../agent
      dockerfile: Dockerfile
    env_file:
      - ${ENV_FILE:-../agent/.env}  # agent 용 .env
    environment:
      - DISPLAY=:99
      - SESSION_ID=${SESSION_ID}
    labels:
      - "bu.session=${SESSION_ID}"
      - "bu.role=agent"
    volumes:
      - x11sock:/tmp/.X11-unix
    depends_on: [vnc]

volumes:
  x11sock: